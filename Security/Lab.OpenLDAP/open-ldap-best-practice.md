# OpenLDAP 最佳實踐

本文件整理了 OpenLDAP 的最佳實踐，涵蓋了安全性、效能、可擴展性以及客戶端應用程式的考量。

## 安全性

*   **使用安全連線**：
    *   在傳送憑證進行身份驗證，以及讀取或寫入任何非公開資料時，務必使用安全連線。
    *   對於 LDAP 應用程式，應連線到目錄伺服器的 LDAPS 埠 (636)，或者如果可能，在每個會話開始時使用 StartTLS 擴展操作在 (明文) LDAP 埠 (389) 上進行加密。
*   **存取控制**：
    *   明智地使用存取控制，以防止使用者透過 LDAP 更改其密碼，尤其是在啟用穿透式身份驗證的情況下。
*   **禁用不安全的綁定**：
    *   如果管理員依賴 TLS 來保護密碼，建議禁用不安全的身份驗證。
    *   這可以透過 `security` 指令的 `simple_bind` 選項來完成，該選項提供對簡單使用者/密碼身份驗證所需機密保護級別的精細控制。

## 效能與可擴展性

*   **索引**：
    *   根據應用程式的典型查詢（特別是 LDAP 過濾器）設定索引。
    *   例如，`olcDbIndex: uid eq` 用於 `(uid=toto)`，`olcDbIndex: uid sub` 用於 `(uid=to*to)`。
    *   `entryCSN` 和 `entryUUID` 在使用複製時應始終建立索引。
*   **分頁搜尋 (Paged Search)**：
    *   如果預期查詢結果集可能非常大，應使用分頁搜尋來分批檢索結果。
    *   這有助於處理伺服器端對單次查詢返回條目數量的限制。
*   **重複使用連線 (Connection Reuse)**：
    *   應用程式應重複使用連線，以避免每次請求都建立和終止連線的開銷。
    *   這可以顯著提高應用程式的效能並減少目錄伺服器的負載。
*   **單一主機寫入 (Single Host Writes)**：
    *   最好將寫入操作導向到單一主機，並將其他主機作為故障轉移或維護的備用。
    *   在不複製更改的副本伺服器上，應配置鏈接 (chaining)，以便將意外的寫入請求鏈接到主機。
*   **負載平衡 (Load Balancing)**：
    *   如果使用負載平衡器為寫入流量設定虛擬 IP (VIP) 位址，則鏈接應指向該 VIP。
*   **多伺服器部署**：
    *   OpenLDAP 代理可以將 LDAP 查詢導向多個 OpenLDAP 伺服器，從而實現多伺服器目錄，有助於擴展性和高可用性。

## 客戶端應用程式實踐

*   **請求所需內容**：只請求應用程式實際需要的屬性，避免不必要的資料傳輸。
*   **使用特定的 LDAP 過濾器**：使用精確的過濾器來縮小搜尋範圍，減少伺服器處理負擔。
*   **信任結果碼**：當應用程式收到結果時，必須檢查結果碼值以確定要採取的動作。
*   **避免伺服器端排序**：盡可能在客戶端進行排序，以減輕伺服器負擔。

## 監控與故障排除

*   **檢查結果碼**：LDAP 結果碼是標準且明確定義的。當應用程式收到結果時，應檢查結果碼值以確定要採取的動作。
*   **利用日誌**：日誌可以提供有關未建立索引的警告以及目錄上使用的過濾器資訊，有助於優化索引配置。
