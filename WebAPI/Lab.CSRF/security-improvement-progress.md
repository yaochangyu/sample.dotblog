# 🔒 安全改善實作進度追蹤

**開始日期**: 2026-01-09  
**目標完成日期**: 2026-01-30  
**負責人**: 開發團隊  
**審查人**: 資深資安專家

---

## 📊 總體進度

**整體完成度**: 0/6 (0%)

| 階段 | 狀態 | 完成度 | 預計完成日 |
|------|------|--------|-----------|
| P0 優先級 | 🔄 進行中 | 0/2 | 2026-01-12 |
| P1 優先級 | ⏳ 待開始 | 0/2 | 2026-01-19 |
| P2 優先級 | ⏳ 待開始 | 0/2 | 2026-01-26 |

---

## 🎯 優先級 P0（立即處理）

### ✅ 改善項目 1: 實作 Rate Limiting（速率限制）
**優先級**: P0 - 嚴重  
**預計工時**: 4 小時  
**負責人**: 開發團隊  
**狀態**: ⏳ 待開始

#### 實作步驟
- [ ] 1.1 安裝 AspNetCoreRateLimit 套件
- [ ] 1.2 建立 appsettings.json 配置
- [ ] 1.3 在 Program.cs 註冊服務
- [ ] 1.4 設定速率限制規則
  - [ ] Token 端點：每分鐘 5 次
  - [ ] Protected 端點：每分鐘 10 次
- [ ] 1.5 啟用 IpRateLimiting 中介軟體
- [ ] 1.6 測試驗證
  - [ ] 正常請求通過
  - [ ] 超量請求被阻擋（429 Too Many Requests）

#### 驗收標準
- [x] 快速連續請求會被限制
- [x] 超過限制回傳 HTTP 429
- [x] 不影響正常使用者體驗

#### 測試記錄
```
測試日期: ____
測試結果: ____
測試人員: ____
```

---

### ✅ 改善項目 2: 實作 Referer 驗證
**優先級**: P0 - 嚴重  
**預計工時**: 3 小時  
**負責人**: 開發團隊  
**狀態**: ⏳ 待開始

#### 實作步驟
- [ ] 2.1 建立 `Attributes` 資料夾
- [ ] 2.2 建立 `RefererValidationAttribute.cs`
- [ ] 2.3 實作驗證邏輯
  - [ ] 檢查 Referer Header 是否存在
  - [ ] 驗證 Referer 是否在允許清單中
  - [ ] 回傳適當的錯誤訊息
- [ ] 2.4 在 Controller 套用 Attribute
- [ ] 2.5 更新允許的 Referer 清單
- [ ] 2.6 測試驗證
  - [ ] 無 Referer 請求被阻擋
  - [ ] 錯誤 Referer 被阻擋
  - [ ] 正確 Referer 通過

#### 驗收標準
- [x] curl 直接請求被阻擋
- [x] 從前端頁面請求成功
- [x] 錯誤訊息清楚明確

#### 測試記錄
```
測試日期: ____
測試結果: ____
測試人員: ____
```

---

## 🎯 優先級 P1（本週內處理）

### ✅ 改善項目 3: 實作 User-Agent 驗證
**優先級**: P1 - 高風險  
**預計工時**: 3 小時  
**負責人**: 開發團隊  
**狀態**: ⏳ 待開始

#### 實作步驟
- [ ] 3.1 建立 `UserAgentValidationAttribute.cs`
- [ ] 3.2 定義阻擋清單
  - [ ] python, curl, wget
  - [ ] scrapy, bot, crawler, spider
  - [ ] postman, insomnia
- [ ] 3.3 實作驗證邏輯
  - [ ] 檢查 User-Agent 是否存在
  - [ ] 檢查長度（至少 10 字元）
  - [ ] 比對阻擋清單
- [ ] 3.4 在 Controller 套用 Attribute
- [ ] 3.5 測試驗證
  - [ ] curl 被阻擋
  - [ ] Python requests 被阻擋
  - [ ] 瀏覽器請求通過

#### 驗收標準
- [x] 已知爬蟲工具被阻擋
- [x] 正常瀏覽器可存取
- [x] 阻擋清單可維護

#### 測試記錄
```
測試日期: ____
測試結果: ____
測試人員: ____
```

---

### ✅ 改善項目 4: 修正 CORS 政策
**優先級**: P1 - 高風險  
**預計工時**: 2 小時  
**負責人**: 開發團隊  
**狀態**: ⏳ 待開始

#### 實作步驟
- [ ] 4.1 修改 Program.cs CORS 設定
- [ ] 4.2 移除 AllowAll 政策
- [ ] 4.3 建立 RestrictedCors 政策
  - [ ] 限制允許的來源
  - [ ] 啟用 AllowCredentials
- [ ] 4.4 更新 app.UseCors 呼叫
- [ ] 4.5 測試驗證
  - [ ] 允許的來源可存取
  - [ ] 非法來源被阻擋
  - [ ] Cookie 正常運作

#### 驗收標準
- [x] 只允許信任的網域
- [x] Cookie 正常傳遞
- [x] 跨域攻擊被阻擋

#### 測試記錄
```
測試日期: ____
測試結果: ____
測試人員: ____
```

---

## 🎯 優先級 P2（本月內處理）

### ✅ 改善項目 5: 設定 Token 過期時間
**優先級**: P2 - 中風險  
**預計工時**: 1 小時  
**負責人**: 開發團隊  
**狀態**: ⏳ 待開始

#### 實作步驟
- [ ] 5.1 在 Program.cs Anti-Forgery 設定中加入 Expiration
- [ ] 5.2 設定適當的過期時間（建議 15 分鐘）
- [ ] 5.3 更新前端處理過期 Token 的邏輯
- [ ] 5.4 測試驗證
  - [ ] Token 在時限內有效
  - [ ] 過期 Token 被拒絕
  - [ ] 前端提示使用者重新取得

#### 驗收標準
- [x] Token 會適時過期
- [x] 過期處理正確
- [x] 使用者體驗良好

#### 測試記錄
```
測試日期: ____
測試結果: ____
測試人員: ____
```

---

### ✅ 改善項目 6: 實作日誌監控
**優先級**: P2 - 中風險  
**預計工時**: 4 小時  
**負責人**: 開發團隊  
**狀態**: ⏳ 待開始

#### 實作步驟
- [ ] 6.1 建立 `Middleware` 資料夾
- [ ] 6.2 建立 `SecurityLoggingMiddleware.cs`
- [ ] 6.3 實作日誌記錄邏輯
  - [ ] 記錄所有 CSRF 請求
  - [ ] 記錄 IP、User-Agent、Referer
  - [ ] 記錄失敗請求
  - [ ] 記錄回應時間
- [ ] 6.4 在 Program.cs 註冊 Middleware
- [ ] 6.5 設定日誌輸出格式（JSON）
- [ ] 6.6 測試驗證
  - [ ] 請求被正確記錄
  - [ ] 失敗請求有警告
  - [ ] 日誌格式正確

#### 驗收標準
- [x] 所有請求都有日誌
- [x] 日誌資訊完整
- [x] 可用於追蹤與分析

#### 測試記錄
```
測試日期: ____
測試結果: ____
測試人員: ____
```

---

## 📈 預期改善效果

### 安全評分變化
| 指標 | 改善前 | 改善後 | 提升 |
|------|--------|--------|------|
| 整體安全評分 | 24/100 🔴 | 82/100 ✅ | +58 |
| CSRF 防護 | 90/100 | 95/100 | +5 |
| 爬蟲防護 | 0/100 | 85/100 | +85 |
| DDoS 防護 | 0/100 | 90/100 | +90 |
| 監控能力 | 0/100 | 75/100 | +75 |

### 威脅防護率變化
| 攻擊類型 | 改善前 | 改善後 | 提升 |
|----------|--------|--------|------|
| 傳統 CSRF | 95% | 98% | +3% |
| 爬蟲濫用 | 0% | 85% | +85% |
| DDoS 攻擊 | 0% | 90% | +90% |
| 工具攻擊 | 0% | 80% | +80% |

---

## 📝 變更記錄

### 2026-01-09
- ✅ 建立安全改善進度追蹤文件
- ✅ 定義 6 個改善項目
- ✅ 規劃實作步驟與驗收標準

---

## 🔄 下次更新

**計畫更新日期**: 2026-01-12  
**更新內容**: P0 項目完成狀況

---

## 📞 聯絡資訊

**遇到問題請聯絡**:
- 技術支援: 開發團隊
- 安全諮詢: 資安專家
- 專案管理: 專案經理

---

**最後更新**: 2026-01-09  
**更新人**: 資深資安專家
