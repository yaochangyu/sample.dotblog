# ðŸ”’ CSRF é˜²è­·æ©Ÿåˆ¶å®‰å…¨æ€§æ¸¬è©¦è¨ˆç•«

**å°ˆæ¡ˆåç¨±**: Lab.CSRF.WebApi  
**æ¸¬è©¦ç›®æ¨™**: ç¢ºä¿å…¬é–‹çš„ Web API ç«¯é»žåƒ…ä¾›ç•¶å‰é é¢å‘¼å«ï¼Œé˜²æ­¢è·¨ç«™è«‹æ±‚å½é€  (CSRF) æ”»æ“Šï¼Œé™ä½Žçˆ¬èŸ²æ¿«ç”¨é¢¨éšª  
**æ¸¬è©¦æ—¥æœŸ**: 2026-01-09  
**æ¸¬è©¦äººå“¡**: è³‡æ·±è³‡å®‰å°ˆå®¶  
**æ–‡ä»¶ç‰ˆæœ¬**: 1.0

---

## å—æ¸¬æ¢ä»¶
- Web API ä¸éœ€è¦é©—è­‰ï¼ŒåŒ¿åä½¿ç”¨

## ðŸ“‹ æ¸¬è©¦ç›®æ¨™
 
### ä¸»è¦ç›®æ¨™
- [ ] é©—è­‰ CSRF Token æ©Ÿåˆ¶æ˜¯å¦æ­£ç¢ºé‹ä½œ
- [ ] ç¢ºèªè·¨ç«™è«‹æ±‚æ˜¯å¦è¢«æœ‰æ•ˆé˜»æ“‹
- [ ] æª¢æ¸¬è‡ªå‹•åŒ–å·¥å…·ï¼ˆçˆ¬èŸ²ï¼‰æ¿«ç”¨é¢¨éšª
- [ ] è©•ä¼°æ•´é«”å®‰å…¨æ€§é˜²è­·ç­‰ç´š

### æ¬¡è¦ç›®æ¨™
- [ ] è­˜åˆ¥æ½›åœ¨çš„å®‰å…¨æ¼æ´ž
- [ ] æä¾›å…·é«”çš„æ”¹å–„å»ºè­°
- [ ] å»ºç«‹å®‰å…¨åŸºæº–ç·š

---

## ðŸŽ¯ æ¸¬è©¦ç¯„åœ

### æ¸¬è©¦å…ƒä»¶
- [ ] **å‰ç«¯é é¢**: `/wwwroot/index.html`
- [ ] **API ç«¯é»ž**:
  - `GET /api/csrf/token` - Token ç”¢ç”Ÿç«¯é»ž
  - `POST /api/csrf/protected` - å—ä¿è­·çš„ API ç«¯é»ž(è¢«æ¸¬ç›®æ¨™ç«¯é»ž)
- [ ] **å¾Œç«¯é…ç½®**: `Program.cs` - Anti-Forgery èˆ‡ CORS è¨­å®š
- [ ] **æŽ§åˆ¶å™¨**: `CsrfController.cs` - API å¯¦ä½œ

### æ¸¬è©¦é¡žåž‹
- [ ] åŠŸèƒ½æ€§æ¸¬è©¦ï¼ˆæ­£å¸¸æµç¨‹ï¼‰
- [ ] å®‰å…¨æ€§æ¸¬è©¦ï¼ˆç•°å¸¸æµç¨‹ï¼‰
- [ ] æ»²é€æ¸¬è©¦ï¼ˆæ”»æ“Šæ¨¡æ“¬ï¼‰
- [ ] é…ç½®å¯©æŸ¥ï¼ˆéœæ…‹åˆ†æžï¼‰

---

## ðŸ“ æ¸¬è©¦é …ç›®æ¸…å–®

### é¡žåˆ¥ 1: CSRF Token åŸºæœ¬åŠŸèƒ½æ¸¬è©¦

#### âœ… æ¸¬è©¦é …ç›® 1.1: Token ç”¢ç”ŸåŠŸèƒ½
- [ ] å‘¼å« `GET /api/csrf/token` èƒ½æˆåŠŸå–å¾—å›žæ‡‰
- [ ] Cookie ä¸­æ­£ç¢ºè¨­å®š `XSRF-TOKEN`
- [ ] Token å€¼ç‚ºéžç©ºå€¼ä¸”ç¬¦åˆæ ¼å¼
- [ ] æ¯æ¬¡è«‹æ±‚ç”¢ç”Ÿçš„ Token çš†ä¸ç›¸åŒ

**æ¸¬è©¦æ–¹æ³•**: ä½¿ç”¨ç€è¦½å™¨é–‹ç™¼è€…å·¥å…·æª¢æŸ¥ Cookieï¼Œä¸¦ä½¿ç”¨ curl é©—è­‰

---

#### âœ… æ¸¬è©¦é …ç›® 1.2: Token é©—è­‰åŠŸèƒ½ï¼ˆæ­£å¸¸æµç¨‹ï¼‰
- [ ] æ”œå¸¶æ­£ç¢º Token çš„è«‹æ±‚èƒ½æˆåŠŸé€šéŽé©—è­‰
- [ ] ä¼ºæœå™¨æ­£ç¢ºå›žæ‡‰æˆåŠŸè¨Šæ¯ï¼ˆHTTP 200 OKï¼‰
- [ ] å›žæ‡‰å…§å®¹åŒ…å«é æœŸçš„è³‡æ–™æ ¼å¼èˆ‡å…§å®¹

**æ¸¬è©¦æ–¹æ³•**: ä½¿ç”¨å‰ç«¯é é¢ã€Œä½¿ç”¨ Token å‘¼å« APIã€æŒ‰éˆ•

---

#### âœ… æ¸¬è©¦é …ç›® 1.3: Token é©—è­‰åŠŸèƒ½ï¼ˆç•°å¸¸æµç¨‹ï¼‰
- [ ] ä¸æ”œå¸¶ Token çš„è«‹æ±‚è¢«æ‹’çµ•ï¼ˆHTTP 400 Bad Requestï¼‰
- [ ] æ”œå¸¶éŒ¯èª¤ Token çš„è«‹æ±‚è¢«æ‹’çµ•ï¼ˆHTTP 400 Bad Requestï¼‰
- [ ] ä½¿ç”¨éŽæœŸ Token çš„è«‹æ±‚è¢«æ‹’çµ•ï¼ˆHTTP 400 Bad Requestï¼‰

**æ¸¬è©¦æ–¹æ³•**: ä½¿ç”¨å‰ç«¯é é¢ã€Œä¸ä½¿ç”¨ Token å‘¼å« APIã€æŒ‰éˆ•ï¼Œä½¿ç”¨ curl æ¸¬è©¦éŒ¯èª¤ Token

---

### é¡žåˆ¥ 2: è·¨ç«™è«‹æ±‚é˜²è­·æ¸¬è©¦

#### âœ… æ¸¬è©¦é …ç›® 2.1: è·¨ç«™è«‹æ±‚é˜»æ“‹ï¼ˆç€è¦½å™¨å ´æ™¯ï¼‰
- [ ] å¾žå¤–éƒ¨ç¶²ç«™ç™¼èµ·çš„è«‹æ±‚ç„¡æ³•å–å¾— Token
- [ ] å¾žå¤–éƒ¨ç¶²ç«™ç™¼èµ·çš„è«‹æ±‚è¢« SameSite Cookie é˜»æ“‹
- [ ] CORS æ”¿ç­–æ­£ç¢ºé‹ä½œ
- [ ] æ¸¬è©¦ä¸åŒç€è¦½å™¨å° SameSite Cookie çš„è¡Œç‚ºå·®ç•°ï¼ˆChromeã€Edgeã€Firefoxã€Safariï¼‰
- [ ] é©—è­‰èˆŠç‰ˆç€è¦½å™¨çš„ç›¸å®¹æ€§è™•ç†

**æ¸¬è©¦æ–¹æ³•**: å»ºç«‹å¤–éƒ¨ HTML æ¸¬è©¦é é¢ï¼Œæ¨¡æ“¬è·¨ç«™æ”»æ“Šï¼Œåœ¨å¤šç¨®ç€è¦½å™¨ç’°å¢ƒæ¸¬è©¦

---

#### âœ… æ¸¬è©¦é …ç›® 2.2: Cookie å®‰å…¨æ€§é…ç½®
- [ ] Cookie è¨­å®šäº† `SameSite=Strict` å±¬æ€§
- [ ] Cookie çš„ `HttpOnly` è¨­å®šç¬¦åˆéœ€æ±‚ï¼ˆæ‡‰ç‚º `false`ï¼Œä»¥ä¾› JavaScript è®€å–ï¼‰
- [ ] HTTPS ç’°å¢ƒä¸‹ `Secure` æ——æ¨™æ­£ç¢ºè¨­å®šç‚º `true`

**æ¸¬è©¦æ–¹æ³•**: æª¢æŸ¥ç¨‹å¼ç¢¼é…ç½®ï¼Œä¸¦ä½¿ç”¨é–‹ç™¼è€…å·¥å…·é©—è­‰ Cookie å±¬æ€§

---

#### âœ… æ¸¬è©¦é …ç›® 2.3: CORS æ”¿ç­–æª¢æŸ¥
- [ ] è¨˜éŒ„ç•¶å‰ CORS è¨­å®šï¼ˆAllowAll æ”¿ç­–ï¼‰
- [ ] è©•ä¼° CORS å¯¬é¬†è¨­å®šçš„å®‰å…¨é¢¨éšª
- [ ] æ¸¬è©¦è·¨åŸŸè«‹æ±‚æ˜¯å¦å…è¨±

**æ¸¬è©¦æ–¹æ³•**: éœæ…‹ç¨‹å¼ç¢¼å¯©æŸ¥ï¼Œä½¿ç”¨ä¸åŒä¾†æºæ¸¬è©¦

---

### é¡žåˆ¥ 3: è‡ªå‹•åŒ–å·¥å…·ï¼ˆçˆ¬èŸ²ï¼‰é˜²è­·æ¸¬è©¦

#### âš ï¸ æ¸¬è©¦é …ç›® 3.1: å‘½ä»¤åˆ—å·¥å…·æ¸¬è©¦ï¼ˆcurlï¼‰
- [ ] curl èƒ½å¦å–å¾— Token
- [ ] curl èƒ½å¦ä½¿ç”¨ Token å‘¼å«å—ä¿è­· API
- [ ] curl èƒ½å¦æ­£ç¢ºç®¡ç† Cookie æœƒè©±ï¼ˆSessionï¼‰
- [ ] æ¸¬è©¦å¤šæ¬¡è«‹æ±‚ä¸­ Token çš„æŒä¹…æ€§
- [ ] è©•ä¼°é˜²è­·æ•ˆæžœ

**æ¸¬è©¦æ–¹æ³•**: ä½¿ç”¨ curl æ¨¡æ“¬å®Œæ•´è«‹æ±‚æµç¨‹ï¼ŒåŒ…å« Cookie æœƒè©±ç®¡ç†

---

#### âš ï¸ æ¸¬è©¦é …ç›® 3.2: Python çˆ¬èŸ²æ¸¬è©¦
- [ ] Python requests èƒ½å¦å–å¾— Token
- [ ] Python requests èƒ½å¦ä½¿ç”¨ Token å‘¼å«å—ä¿è­· API
- [ ] æ¸¬è©¦ requests.Session() çš„æœƒè©±ç®¡ç†èƒ½åŠ›
- [ ] é©—è­‰ Cookie æŒä¹…åŒ–èˆ‡é‡ç”¨æ©Ÿåˆ¶
- [ ] è©•ä¼°é˜²è­·æ•ˆæžœ

**æ¸¬è©¦æ–¹æ³•**: ç·¨å¯«ä¸¦åŸ·è¡Œ Python æ¸¬è©¦è…³æœ¬ï¼ŒåŒ…å«æœƒè©±ç®¡ç†æ¸¬è©¦

---

#### âš ï¸ æ¸¬è©¦é …ç›® 3.3: Postman æ¸¬è©¦
- [ ] Postman èƒ½å¦å–å¾— Token
- [ ] Postman èƒ½å¦ä½¿ç”¨ Token å‘¼å«å—ä¿è­· API
- [ ] Postman è‡ªå‹•æœƒè©±ç®¡ç†æ˜¯å¦æœ‰æ•ˆ
- [ ] æ¸¬è©¦æ‰‹å‹•è¨­å®š Cookie çš„è¡Œç‚º
- [ ] è©•ä¼°é˜²è­·æ•ˆæžœ

**æ¸¬è©¦æ–¹æ³•**: ä½¿ç”¨ Postman æ‰‹å‹•æ¸¬è©¦ï¼ŒåŒ…å«æœƒè©±èˆ‡ Cookie ç®¡ç†é©—è­‰

---

### é¡žåˆ¥ 4: é€²éšŽå®‰å…¨æ€§æ¸¬è©¦

#### ðŸ”´ æ¸¬è©¦é …ç›® 4.1: é€ŸçŽ‡é™åˆ¶ï¼ˆRate Limitingï¼‰
- [ ] æª¢æŸ¥æ˜¯å¦æœ‰é€ŸçŽ‡é™åˆ¶æ©Ÿåˆ¶
- [ ] çŸ­æ™‚é–“å¤§é‡è«‹æ±‚æ˜¯å¦è¢«é˜»æ“‹
- [ ] å®šç¾©æ­£å¸¸ä½¿ç”¨è€…çš„è«‹æ±‚é »çŽ‡åŸºæº–ç·šï¼ˆä¾‹å¦‚ï¼šæ¯åˆ†é˜ 60 æ¬¡ï¼‰
- [ ] å®šç¾©æƒ¡æ„ä½¿ç”¨è€…çš„é˜»æ“‹é–¾å€¼ï¼ˆä¾‹å¦‚ï¼šæ¯åˆ†é˜ 100 æ¬¡ï¼‰
- [ ] æ¸¬è©¦é”åˆ°é–¾å€¼å¾Œçš„å›žæ‡‰è¡Œç‚ºï¼ˆ429 Too Many Requestsï¼‰
- [ ] è©•ä¼° DDoS é˜²è­·èƒ½åŠ›

**æ¸¬è©¦æ–¹æ³•**: ä½¿ç”¨è…³æœ¬ç™¼é€ä¸åŒé »çŽ‡çš„ä¸¦ç™¼è«‹æ±‚ï¼Œé©—è­‰é–¾å€¼è¨­å®š

---

#### ðŸ”´ æ¸¬è©¦é …ç›® 4.2: User-Agent é©—è­‰
- [ ] æª¢æŸ¥æ˜¯å¦é©—è­‰ User-Agent Header
- [ ] å·²çŸ¥çˆ¬èŸ²å·¥å…·çš„ User-Agent æ˜¯å¦è¢«é˜»æ“‹
- [ ] è©•ä¼°çˆ¬èŸ²é˜²è­·èƒ½åŠ›

**æ¸¬è©¦æ–¹æ³•**: ä½¿ç”¨ä¸åŒ User-Agent ç™¼é€è«‹æ±‚

---

#### ðŸ”´ æ¸¬è©¦é …ç›® 4.3: Referer/Origin é©—è­‰
- [ ] æª¢æŸ¥æ˜¯å¦é©—è­‰ Referer Header
- [ ] æª¢æŸ¥æ˜¯å¦é©—è­‰ Origin Header
- [ ] æ¸¬è©¦ Origin èˆ‡ Referer çš„å·®ç•°æ€§ï¼ˆOrigin æ›´å¯é ï¼Œç„¡æ³•è¢«è¼•æ˜“å½é€ ï¼‰
- [ ] ä¾†è‡ªéžæ³•ä¾†æºçš„è«‹æ±‚æ˜¯å¦è¢«é˜»æ“‹
- [ ] æ¸¬è©¦ç¼ºå°‘ Referer/Origin Header çš„è«‹æ±‚è™•ç†
- [ ] æ¸¬è©¦å½é€  Referer çš„é˜²è­·æ•ˆæžœ
- [ ] è©•ä¼°ä¾†æºé©—è­‰æ•ˆæžœ

**æ¸¬è©¦æ–¹æ³•**: ä½¿ç”¨ä¸åŒ Referer èˆ‡ Origin ç™¼é€è«‹æ±‚ï¼Œæ¯”å°é©—è­‰çµæžœ

---

#### ðŸŸ¡ æ¸¬è©¦é …ç›® 4.4: Token æ™‚æ•ˆæ€§
- [ ] æª¢æŸ¥ Token çš„æœ‰æ•ˆæœŸé™è¨­å®š
- [ ] Token æ˜¯å¦æœƒé©æ™‚éŽæœŸ
- [ ] éŽæœŸè™•ç†æ˜¯å¦æ­£ç¢º

**æ¸¬è©¦æ–¹æ³•**: æª¢æŸ¥ç¨‹å¼ç¢¼é…ç½®ï¼Œç­‰å¾…æ™‚é–“æ¸¬è©¦

---

#### ðŸŸ¡ æ¸¬è©¦é …ç›® 4.5: æ—¥èªŒèˆ‡ç›£æŽ§
- [ ] æª¢æŸ¥æ˜¯å¦è¨˜éŒ„å®‰å…¨ç›¸é—œäº‹ä»¶
- [ ] æª¢æŸ¥æ˜¯å¦è¨˜éŒ„å¤±æ•—çš„è«‹æ±‚
- [ ] è©•ä¼°å¯è¿½è¹¤æ€§

**æ¸¬è©¦æ–¹æ³•**: æª¢æŸ¥ç¨‹å¼ç¢¼ï¼ŒæŸ¥çœ‹æ—¥èªŒè¼¸å‡º

---

#### ðŸ”´ æ¸¬è©¦é …ç›® 4.6: Token é‡æ”¾æ”»æ“Šï¼ˆReplay Attackï¼‰
- [ ] æ“·å–å·²ä½¿ç”¨çš„ Token
- [ ] å˜—è©¦é‡è¤‡ä½¿ç”¨ç›¸åŒ Token ç™¼é€å¤šæ¬¡è«‹æ±‚
- [ ] é©—è­‰ç³»çµ±æ˜¯å¦é˜»æ“‹ Token é‡æ”¾
- [ ] æª¢æŸ¥ Token æ˜¯å¦ç‚ºä¸€æ¬¡æ€§ä½¿ç”¨ï¼ˆSingle-Useï¼‰
- [ ] è©•ä¼°é‡æ”¾æ”»æ“Šçš„é¢¨éšªç­‰ç´š

**æ¸¬è©¦æ–¹æ³•**: æ””æˆªä¸¦å„²å­˜å·²ä½¿ç”¨çš„ Tokenï¼Œå˜—è©¦é‡è¤‡ç™¼é€è«‹æ±‚

---

#### ðŸŸ¡ æ¸¬è©¦é …ç›® 4.7: Token ç†µå€¼ï¼ˆEntropyï¼‰åˆ†æž
- [ ] æ”¶é›†å¤šçµ„ Token æ¨£æœ¬ï¼ˆå»ºè­° 100+ çµ„ï¼‰
- [ ] åˆ†æž Token çš„éš¨æ©Ÿæ€§èˆ‡ä¸å¯é æ¸¬æ€§
- [ ] æª¢æŸ¥ Token æ˜¯å¦åŒ…å«å¯è­˜åˆ¥çš„æ¨¡å¼æˆ–åºåˆ—
- [ ] è©•ä¼° Token ç”Ÿæˆæ¼”ç®—æ³•çš„å¼·åº¦
- [ ] é©—è­‰ Token é•·åº¦æ˜¯å¦ç¬¦åˆå®‰å…¨æ¨™æº–ï¼ˆå»ºè­° 128+ bitsï¼‰

**æ¸¬è©¦æ–¹æ³•**: çµ±è¨ˆåˆ†æžå¤šçµ„ Tokenï¼Œä½¿ç”¨ç†µå€¼è¨ˆç®—å·¥å…·è©•ä¼°éš¨æ©Ÿæ€§

---

#### ðŸŸ¡ æ¸¬è©¦é …ç›® 4.8: HTTPS é™ç´šæ”»æ“Šæ¸¬è©¦
- [ ] æ¸¬è©¦åœ¨ HTTP ç’°å¢ƒä¸‹çš„ Cookie è¡Œç‚º
- [ ] é©—è­‰ Secure æ——æ¨™æ˜¯å¦æ­£ç¢ºé˜»æ“‹ HTTP å‚³è¼¸
- [ ] æ¸¬è©¦ä¸­é–“äººæ”»æ“Šï¼ˆMITMï¼‰æƒ…å¢ƒä¸‹çš„é˜²è­·
- [ ] æª¢æŸ¥æ˜¯å¦å¼·åˆ¶ HTTPS é‡å°Žå‘
- [ ] è©•ä¼°å‚³è¼¸å±¤å®‰å…¨æ€§

**æ¸¬è©¦æ–¹æ³•**: åœ¨ HTTP èˆ‡ HTTPS ç’°å¢ƒåˆ†åˆ¥æ¸¬è©¦ï¼Œæ¨¡æ“¬é™ç´šæ”»æ“Š

---

#### ðŸŸ¢ æ¸¬è©¦é …ç›® 4.9: ç€è¦½å™¨ç›¸å®¹æ€§æ¸¬è©¦
- [ ] Chromeï¼ˆæœ€æ–°ç‰ˆï¼‰çš„ SameSite Cookie è¡Œç‚º
- [ ] Edgeï¼ˆæœ€æ–°ç‰ˆï¼‰çš„ SameSite Cookie è¡Œç‚º
- [ ] Firefoxï¼ˆæœ€æ–°ç‰ˆï¼‰çš„ SameSite Cookie è¡Œç‚º
- [ ] Safariï¼ˆæœ€æ–°ç‰ˆï¼‰çš„ SameSite Cookie è¡Œç‚º
- [ ] èˆŠç‰ˆç€è¦½å™¨çš„ç›¸å®¹æ€§ï¼ˆIE11ã€èˆŠç‰ˆ Safariï¼‰
- [ ] è¡Œå‹•è£ç½®ç€è¦½å™¨ï¼ˆiOS Safariã€Android Chromeï¼‰
- [ ] è©•ä¼°è·¨ç€è¦½å™¨ä¸€è‡´æ€§

**æ¸¬è©¦æ–¹æ³•**: åœ¨ä¸åŒç€è¦½å™¨èˆ‡ç‰ˆæœ¬åŸ·è¡Œç›¸åŒæ¸¬è©¦æ¡ˆä¾‹ï¼Œæ¯”å°çµæžœ

---

### é¡žåˆ¥ 5: é…ç½®å®‰å…¨æ€§å¯©æŸ¥

#### âœ… æ¸¬è©¦é …ç›® 5.1: Anti-Forgery é…ç½®å¯©æŸ¥
- [ ] HeaderName è¨­å®šæ­£ç¢º
- [ ] Cookie åç¨±è¨­å®šæ­£ç¢º
- [ ] SameSite è¨­å®šç¬¦åˆå®‰å…¨è¦æ±‚
- [ ] SecurePolicy è¨­å®šç¬¦åˆç’°å¢ƒéœ€æ±‚

**æ¸¬è©¦æ–¹æ³•**: éœæ…‹ç¨‹å¼ç¢¼å¯©æŸ¥

---

#### âš ï¸ æ¸¬è©¦é …ç›® 5.2: CORS é…ç½®å¯©æŸ¥
- [ ] è©•ä¼° `AllowAnyOrigin` çš„å®‰å…¨é¢¨éšª
- [ ] è©•ä¼° `AllowAnyMethod` çš„å®‰å…¨é¢¨éšª
- [ ] è©•ä¼° `AllowAnyHeader` çš„å®‰å…¨é¢¨éšª
- [ ] æä¾›é‡å°æ€§çš„æ”¹å–„å»ºè­°

**æ¸¬è©¦æ–¹æ³•**: éœæ…‹ç¨‹å¼ç¢¼å¯©æŸ¥ï¼Œä¸¦æ¯”å°å®‰å…¨æœ€ä½³å¯¦è¸

---

#### âœ… æ¸¬è©¦é …ç›® 5.3: æŽ§åˆ¶å™¨å¯¦ä½œå¯©æŸ¥
- [ ] `[IgnoreAntiforgeryToken]` ä½¿ç”¨æ˜¯å¦åˆç†
- [ ] `[ValidateAntiForgeryToken]` æ˜¯å¦æ­£ç¢ºå¥—ç”¨
- [ ] API ç«¯é»žæ˜¯å¦å…·å‚™é©ç•¶çš„å®‰å…¨é©—è­‰æ©Ÿåˆ¶

**æ¸¬è©¦æ–¹æ³•**: éœæ…‹ç¨‹å¼ç¢¼å¯©æŸ¥

---

## ðŸ› ï¸ æ¸¬è©¦å·¥å…·

### æ‰‹å‹•æ¸¬è©¦å·¥å…·
- [ ] ç€è¦½å™¨ï¼ˆChrome/Edgeï¼‰é–‹ç™¼è€…å·¥å…·
- [ ] Postman / Insomnia
- [ ] curl å‘½ä»¤åˆ—å·¥å…·

### è‡ªå‹•åŒ–æ¸¬è©¦å·¥å…·
- [ ] Python requests å¥—ä»¶
- [ ] Bash è…³æœ¬ï¼ˆä¸¦ç™¼æ¸¬è©¦ï¼‰
- [ ] è‡ªè¨‚æ¸¬è©¦è…³æœ¬

### åˆ†æžå·¥å…·
- [ ] éœæ…‹ç¨‹å¼ç¢¼åˆ†æžï¼ˆäººå·¥å¯©æŸ¥ï¼‰
- [ ] ç¶²è·¯å°åŒ…åˆ†æžï¼ˆå¦‚éœ€è¦ï¼‰

---

## ðŸ“Š æ¸¬è©¦æ¨™æº–

### åŠŸèƒ½æ€§æ¸¬è©¦
- **é€šéŽæ¨™æº–**: æ­£å¸¸æµç¨‹ 100% æˆåŠŸ
- **å¤±æ•—æ¨™æº–**: ç•°å¸¸æµç¨‹ 100% è¢«é˜»æ“‹

### å®‰å…¨æ€§æ¸¬è©¦
- **é«˜å®‰å…¨**: å‚³çµ± CSRF æ”»æ“Š 100% é˜»æ“‹
- **ä¸­å®‰å…¨**: çˆ¬èŸ²æ¿«ç”¨ > 80% é˜»æ“‹
- **ä½Žå®‰å…¨**: çˆ¬èŸ²æ¿«ç”¨ < 50% é˜»æ“‹

### é¢¨éšªç­‰ç´šå®šç¾©
- ðŸ”´ **åš´é‡**: å¯ç›´æŽ¥é€ æˆè³‡æ–™æ´©æ¼æˆ–æœå‹™ç™±ç˜“
- ðŸŸ  **é«˜é¢¨éšª**: é¡¯è‘—é™ä½Žå®‰å…¨æ€§ï¼Œå®¹æ˜“è¢«åˆ©ç”¨
- ðŸŸ¡ **ä¸­é¢¨éšª**: æœ‰å®‰å…¨éš±æ‚£ï¼Œä½†åˆ©ç”¨é›£åº¦è¼ƒé«˜
- ðŸŸ¢ **ä½Žé¢¨éšª**: ç†è«–é¢¨éšªï¼Œå¯¦éš›å½±éŸ¿å°

---

## ðŸ“… æ¸¬è©¦åŸ·è¡Œè¨ˆç•«

### éšŽæ®µ 1: åŸºç¤ŽåŠŸèƒ½é©—è­‰ï¼ˆ30 åˆ†é˜ï¼‰
- [ ] æ¸¬è©¦é …ç›® 1.1 - Token ç”¢ç”ŸåŠŸèƒ½
- [ ] æ¸¬è©¦é …ç›® 1.2 - Token é©—è­‰ï¼ˆæ­£å¸¸æµç¨‹ï¼‰
- [ ] æ¸¬è©¦é …ç›® 1.3 - Token é©—è­‰ï¼ˆç•°å¸¸æµç¨‹ï¼‰

### éšŽæ®µ 2: CSRF é˜²è­·é©—è­‰ï¼ˆ30 åˆ†é˜ï¼‰
- [ ] æ¸¬è©¦é …ç›® 2.1 - è·¨ç«™è«‹æ±‚é˜»æ“‹
- [ ] æ¸¬è©¦é …ç›® 2.2 - Cookie å®‰å…¨æ€§
- [ ] æ¸¬è©¦é …ç›® 2.3 - CORS æ”¿ç­–

### éšŽæ®µ 3: çˆ¬èŸ²é˜²è­·æ¸¬è©¦ï¼ˆ45 åˆ†é˜ï¼‰
- [ ] æ¸¬è©¦é …ç›® 3.1 - curl æ¸¬è©¦
- [ ] æ¸¬è©¦é …ç›® 3.2 - Python çˆ¬èŸ²æ¸¬è©¦
- [ ] æ¸¬è©¦é …ç›® 3.3 - Postman æ¸¬è©¦

### éšŽæ®µ 4: é€²éšŽå®‰å…¨æ¸¬è©¦ï¼ˆ90 åˆ†é˜ï¼‰
- [ ] æ¸¬è©¦é …ç›® 4.1 - é€ŸçŽ‡é™åˆ¶
- [ ] æ¸¬è©¦é …ç›® 4.2 - User-Agent é©—è­‰
- [ ] æ¸¬è©¦é …ç›® 4.3 - Referer/Origin é©—è­‰
- [ ] æ¸¬è©¦é …ç›® 4.4 - Token æ™‚æ•ˆæ€§
- [ ] æ¸¬è©¦é …ç›® 4.5 - æ—¥èªŒç›£æŽ§
- [ ] æ¸¬è©¦é …ç›® 4.6 - Token é‡æ”¾æ”»æ“Š
- [ ] æ¸¬è©¦é …ç›® 4.7 - Token ç†µå€¼åˆ†æž
- [ ] æ¸¬è©¦é …ç›® 4.8 - HTTPS é™ç´šæ”»æ“Š
- [ ] æ¸¬è©¦é …ç›® 4.9 - ç€è¦½å™¨ç›¸å®¹æ€§

### éšŽæ®µ 5: é…ç½®å¯©æŸ¥ï¼ˆ30 åˆ†é˜ï¼‰
- [ ] æ¸¬è©¦é …ç›® 5.1 - Anti-Forgery é…ç½®
- [ ] æ¸¬è©¦é …ç›® 5.2 - CORS é…ç½®
- [ ] æ¸¬è©¦é …ç›® 5.3 - Controller å¯¦ä½œ

### éšŽæ®µ 6: å ±å‘Šæ’°å¯«ï¼ˆ30 åˆ†é˜ï¼‰
- [ ] å½™æ•´æ¸¬è©¦çµæžœ
- [ ] åˆ†æžå®‰å…¨é¢¨éšª
- [ ] æä¾›æ”¹å–„å»ºè­°
- [ ] ç”¢ç”Ÿæ¸¬è©¦å ±å‘Š

**é è¨ˆç¸½æ™‚é–“**: 4.0 å°æ™‚

---

## ðŸ“‹ æ¸¬è©¦è³‡æ–™æº–å‚™

### æ¸¬è©¦ API ç«¯é»ž
- **Token ç«¯é»ž**: `http://localhost:5073/api/csrf/token`
- **Protected ç«¯é»ž**: `http://localhost:5073/api/csrf/protected`

### æ¸¬è©¦è³‡æ–™
```json
{
  "data": "Security Test Data"
}
```

### æ¸¬è©¦å ´æ™¯
1. **æ­£å¸¸ä½¿ç”¨è€…**: å¾žå‰ç«¯é é¢æ“ä½œ
2. **æƒ¡æ„ä½¿ç”¨è€…**: å¾žå¤–éƒ¨ç¶²ç«™æ”»æ“Š
3. **è‡ªå‹•åŒ–å·¥å…·**: ä½¿ç”¨çˆ¬èŸ²å˜—è©¦å­˜å–
4. **DDoS æ”»æ“Š**: å¤§é‡ä¸¦ç™¼è«‹æ±‚

---

## âœ… å®Œæˆæ¨™æº–

### æ¸¬è©¦è¨ˆç•«å®Œæˆæ¢ä»¶
- [ ] æ‰€æœ‰æ¸¬è©¦é …ç›®éƒ½å·²åˆ—å‡º
- [ ] æ¯å€‹æ¸¬è©¦é …ç›®éƒ½æœ‰æ˜Žç¢ºçš„é©—è­‰æ¨™æº–
- [ ] æ¸¬è©¦æ–¹æ³•æ¸…æ¥šèªªæ˜Ž
- [ ] æ¸¬è©¦å·¥å…·æº–å‚™å°±ç·’

### æ¸¬è©¦åŸ·è¡Œå®Œæˆæ¢ä»¶
- [ ] æ‰€æœ‰æ¸¬è©¦é …ç›®éƒ½å·²åŸ·è¡Œ
- [ ] æ¯å€‹æ¸¬è©¦é …ç›®éƒ½æœ‰è¨˜éŒ„çµæžœ
- [ ] æ‰€æœ‰ç™¼ç¾çš„å•é¡Œéƒ½å·²è¨˜éŒ„
- [ ] æ¸¬è©¦å ±å‘Šå·²ç”¢ç”Ÿ

---

## ðŸ“ å‚™è¨»

### å®‰å…¨æ€§è€ƒé‡
- æ¸¬è©¦éŽç¨‹ä¸­é¿å…å¯¦éš›ç ´å£žè³‡æ–™æˆ–å½±éŸ¿ç³»çµ±ç©©å®šæ€§
- åƒ…åœ¨é–‹ç™¼ç’°å¢ƒåŸ·è¡Œæ¸¬è©¦ï¼Œé¿å…å½±éŸ¿ç”Ÿç”¢ç’°å¢ƒ
- æ¸¬è©¦è…³æœ¬åŸ·è¡Œå¾Œé ˆæ¸…ç†ç”¢ç”Ÿçš„æ¸¬è©¦è³‡æ–™

### é æœŸé¢¨éšª
æ ¹æ“šåˆæ­¥åˆ†æžï¼Œé æœŸå¯èƒ½ç™¼ç¾ä»¥ä¸‹å®‰å…¨å•é¡Œï¼š
1. ðŸ”´ çˆ¬èŸ²å¯å®Œå…¨ç¹žéŽ CSRF é˜²è­·ï¼ˆåš´é‡ï¼‰
2. ðŸ”´ ç¼ºä¹é€ŸçŽ‡é™åˆ¶æ©Ÿåˆ¶ï¼ˆåš´é‡ï¼‰
3. ðŸ”´ Token å¯èƒ½è¢«é‡æ”¾æ”»æ“Šåˆ©ç”¨ï¼ˆåš´é‡ï¼‰
4. ðŸŸ  CORS æ”¿ç­–éŽæ–¼å¯¬é¬†ï¼ˆé«˜é¢¨éšªï¼‰
5. ðŸŸ  ç¼ºå°‘ Referer/Origin é©—è­‰ï¼ˆé«˜é¢¨éšªï¼‰
6. ðŸŸ  ç¼ºå°‘ User-Agent é©—è­‰ï¼ˆé«˜é¢¨éšªï¼‰
7. ðŸŸ¡ Token ç†µå€¼å¯èƒ½ä¸è¶³ï¼ˆä¸­é¢¨éšªï¼‰
8. ðŸŸ¡ HTTPS é™ç´šæ”»æ“Šé¢¨éšªï¼ˆä¸­é¢¨éšªï¼‰
9. ðŸŸ¢ ç€è¦½å™¨ç›¸å®¹æ€§å•é¡Œï¼ˆä½Žé¢¨éšªï¼‰

### æ”¹å–„å»ºè­°æ–¹å‘
1. å¯¦ä½œé€ŸçŽ‡é™åˆ¶ï¼ˆRate Limitingï¼‰æ©Ÿåˆ¶
2. åŠ å…¥ Referer/Origin Header é©—è­‰
3. åŠ å…¥ User-Agent é©—è­‰èˆ‡éŽæ¿¾
4. æ”¶ç·Š CORS æ”¿ç­–ï¼Œé™åˆ¶å…è¨±çš„ä¾†æº
5. åŠ å…¥æ—¥èªŒç›£æŽ§èˆ‡ç•°å¸¸åµæ¸¬æ©Ÿåˆ¶
6. å¯¦ä½œ Token ä¸€æ¬¡æ€§ä½¿ç”¨ï¼ˆSingle-Useï¼‰æ©Ÿåˆ¶
7. å¼·åŒ– Token ç”Ÿæˆæ¼”ç®—æ³•ï¼Œæå‡ç†µå€¼
8. å¼·åˆ¶ HTTPS é€£ç·šï¼Œé˜²æ­¢é™ç´šæ”»æ“Š
9. é‡å°ä¸åŒç€è¦½å™¨é€²è¡Œç›¸å®¹æ€§è™•ç†

---

**æ¸¬è©¦è¨ˆç•«åˆ¶å®šæ—¥æœŸ**: 2026-01-09  
**è¨ˆç•«åˆ¶å®šäºº**: è³‡æ·±è³‡å®‰å°ˆå®¶  
**å¯©æŸ¥ç‹€æ…‹**: âœ… å·²å®Œæˆ

---

## ðŸš€ ä¸‹ä¸€æ­¥è¡Œå‹•

1. **åŸ·è¡Œæ¸¬è©¦**: æŒ‰ç…§æœ¬è¨ˆç•«é€é …åŸ·è¡Œæ¸¬è©¦ï¼Œä¸¦è¨˜éŒ„çµæžœè‡³ `security-test-result.md`
2. **åˆ†æžçµæžœ**: åˆ†æžæ¸¬è©¦çµæžœï¼Œè­˜åˆ¥å®‰å…¨æ¼æ´žèˆ‡é¢¨éšªç­‰ç´š
3. **åˆ¶å®šæ”¹å–„æ–¹æ¡ˆ**: æ ¹æ“šæ¸¬è©¦çµæžœï¼Œç”¢ç”Ÿ `security-test-improve.plan.md` æ”¹å–„è¨ˆç•«