version: "3"

dotenv: [ "secrets/secrets.env" ]

tasks:
  spec-codegen:
    desc: 產生 Client / Server Code
    cmds:
      - task: spec-merge-file
      - task: spec-codegen-client
      - task: spec-codegen-server
        
  spec-codegen-client:
    desc: 產生 Client Code
    cmds:
      - nswag openapi2csclient /input:doc/merge/index.yaml /classname:LabSpecClient /namespace:Lab.SpecFirst.Adapter /output:src/Lab.SpecFirst.Adapter/AutoGenerated/LabSpecClient.cs /jsonLibrary:SystemTextJson /generateClientInterfaces:true /exposeJsonSerializerSettings:false /useBaseUrl:false

  spec-codegen-server:
    desc: 產生 Server Code
    cmds:
      - nswag openapi2cscontroller /input:doc/merge/index.yaml /classname:SpecFirstContract /namespace:Lab.SpecFirst.Web.Controllers /output:src/Lab.SpecFirst.Web/AutoGenerated/Controller.cs /jsonLibrary:SystemTextJson 
  
  spec-merge-file:
    desc: 合併 Swagger File
    cmds:
#      - speccy resolve ./doc/index.yaml -o ./doc/merge/index.yaml
#      - swagger-cli bundle ./doc/index.yaml --outfile ./doc/merge/index.yaml --type yaml
      - openapi-merger -i ./doc/index.yaml -o ./doc/merge/index.yaml
        