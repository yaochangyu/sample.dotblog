<!DOCTYPE html>
<html lang='zh-TW'>
<head>
    <meta charset='UTF-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0'>
    <title>æª”æ¡ˆæ¨™è¨˜ç‹€æ…‹ç¶œåˆå ±è¡¨</title>
    <style>
        body { font-family: 'Microsoft JhengHei', Arial, sans-serif; margin: 20px; background-color: #f5f5f5; }
        .container { max-width: 1400px; margin: 0 auto; background-color: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        h1 { color: #2d3748; border-bottom: 3px solid #667eea; padding-bottom: 10px; }
        h2 { color: #4a5568; margin-top: 30px; padding: 10px; border-left: 4px solid #667eea; background-color: #f7fafc; }

        /* æ‘˜è¦å€å¡Š */
        .summary { background: linear-gradient(135deg, #f6f8fb 0%, #e9ecef 100%); padding: 20px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #dee2e6; }
        .summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px; }
        .summary-item { background: white; padding: 15px; border-radius: 6px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .summary-label { color: #718096; font-size: 0.9em; margin-bottom: 5px; }
        .summary-value { color: #2d3748; font-size: 1.5em; font-weight: bold; }
        .summary-size { color: #4a5568; font-size: 0.85em; margin-top: 5px; }

        /* åˆ†é æ¨™ç±¤ */
        .tabs { display: flex; border-bottom: 2px solid #e2e8f0; margin-bottom: 20px; gap: 5px; }
        .tab { padding: 12px 24px; cursor: pointer; background-color: #f7fafc; border: 1px solid #e2e8f0; border-bottom: none; border-radius: 6px 6px 0 0; transition: all 0.3s; }
        .tab:hover { background-color: #edf2f7; }
        .tab.active { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-color: #667eea; font-weight: 600; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* æª”æ¡ˆé …ç›® */
        .file-list { max-height: 600px; overflow-y: auto; }
        .file-item { background-color: white; padding: 12px; margin-bottom: 10px; border-left: 4px solid #667eea; border-radius: 4px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
        .file-item.missing { border-left-color: #e53e3e; background-color: #fff5f5; }
        .file-path { font-family: 'Consolas', monospace; color: #2d3748; word-break: break-all; font-weight: 500; margin-bottom: 8px; }
        .file-info { color: #718096; font-size: 0.9em; margin-top: 5px; display: flex; flex-wrap: wrap; gap: 15px; }
        .file-info-item { display: flex; align-items: center; gap: 5px; }

        /* å¾½ç«  */
        .badge { display: inline-block; padding: 4px 10px; border-radius: 12px; font-size: 0.85em; font-weight: 600; margin-right: 8px; }
        .badge-exists { background-color: #48bb78; color: white; }
        .badge-missing { background-color: #f56565; color: white; }
        .badge-processed { background-color: #4299e1; color: white; }
        .badge-pending { background-color: #ed8936; color: white; }
        .badge-unmarked { background-color: #cbd5e0; color: #2d3748; }

        /* æŒ‰éˆ• */
        .toggle-all { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; margin-bottom: 15px; font-weight: 600; box-shadow: 0 2px 4px rgba(102, 126, 234, 0.3); }
        .toggle-all:hover { background: linear-gradient(135deg, #5568d3 0%, #653a8b 100%); box-shadow: 0 4px 8px rgba(102, 126, 234, 0.4); }

        /* ç©ºç‹€æ…‹ */
        .empty-state { text-align: center; padding: 40px; color: #a0aec0; font-style: italic; }

        /* çµ±è¨ˆæ¨™ç±¤ */
        .count-badge { background-color: #667eea; color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.85em; margin-left: 8px; }

        /* ç¾¤çµ„æª”æ¡ˆåˆ—è¡¨ */
        .group-files-container { margin-top: 10px; }
        .group-files-toggle {
            background-color: #f7fafc;
            border: 1px solid #e2e8f0;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            display: inline-block;
            font-weight: 500;
            color: #4a5568;
            transition: all 0.3s;
        }
        .group-files-toggle:hover { background-color: #edf2f7; }
        .group-files-list {
            margin-top: 10px;
            padding-left: 20px;
            border-left: 2px solid #e2e8f0;
            display: none;
        }
        .group-files-list.expanded { display: block; }
        .group-file-item {
            padding: 8px;
            margin: 5px 0;
            background-color: #f7fafc;
            border-radius: 4px;
            border-left: 3px solid #cbd5e0;
        }
        .group-file-item.mark-0 { border-left-color: #cbd5e0; }
        .group-file-item.mark-1 { border-left-color: #fc8181; background-color: #fff5f5; }
        .group-file-item.mark-2 { border-left-color: #63b3ed; background-color: #ebf8ff; }
        .group-file-item.mark-3 { border-left-color: #68d391; background-color: #f0fff4; }
        .badge-mark-0 { background-color: #cbd5e0; color: #2d3748; }
        .badge-mark-1 { background-color: #fc8181; color: white; }
        .badge-mark-2 { background-color: #63b3ed; color: white; }
        .badge-mark-3 { background-color: #68d391; color: white; }
    </style>
</head>
<body>
    <!-- è³‡æ–™ JSON -->
    <script type="application/json" id="reportData">{{REPORT_DATA}}</script>

    <div class='container'>
        <h1>æª”æ¡ˆæ¨™è¨˜ç‹€æ…‹ç¶œåˆå ±è¡¨</h1>

        <!-- æ‘˜è¦ -->
        <div class='summary'>
            <div style="font-weight: bold; font-size: 1.1em; margin-bottom: 10px;">
                ç”¢ç”Ÿæ™‚é–“ï¼š<span id="generated-time"></span>
            </div>
            <div class="summary-grid">
                <div class="summary-item">
                    <div class="summary-label">ç¸½æª”æ¡ˆæ•¸</div>
                    <div class="summary-value" id="total-files">0</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">é‡è¤‡æª”æ¡ˆç¾¤çµ„</div>
                    <div class="summary-value" id="duplicate-groups-count">0</div>
                    <div class="summary-size" id="duplicate-groups-size"></div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">æœ€å¤§é‡è¤‡æ•¸</div>
                    <div class="summary-value" id="max-duplicate-count">0</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">æœªæ¨™è¨˜</div>
                    <div class="summary-value" id="unmarked-count">0</div>
                    <div class="summary-size" id="unmarked-size"></div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">å·²æ¨™è¨˜åˆªé™¤</div>
                    <div class="summary-value" id="deletion-count">0</div>
                    <div class="summary-size" id="deletion-size"></div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">å·²æ¨™è¨˜ç§»å‹•</div>
                    <div class="summary-value" id="move-count">0</div>
                    <div class="summary-size" id="move-size"></div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">å·²æ¨™è¨˜ç•¥é</div>
                    <div class="summary-value" id="skipped-count">0</div>
                    <div class="summary-size" id="skipped-size"></div>
                </div>
            </div>
        </div>

        <!-- åˆ†é  -->
        <div class="tabs">
            <div class="tab active" data-tab="groups">
                é‡è¤‡æª”æ¡ˆç¾¤çµ„ <span class="count-badge" id="tab-groups-count">0</span>
            </div>
            <div class="tab" data-tab="groups-by-count">
                é‡è¤‡æª”æ¡ˆç¾¤çµ„ (æŒ‰é‡è¤‡æ¬¡æ•¸) <span class="count-badge" id="tab-groups-by-count-count">0</span>
            </div>
            <div class="tab" data-tab="unmarked">
                æœªæ¨™è¨˜ <span class="count-badge" id="tab-unmarked-count">0</span>
            </div>
            <div class="tab" data-tab="deletion">
                å·²æ¨™è¨˜åˆªé™¤ <span class="count-badge" id="tab-deletion-count">0</span>
            </div>
            <div class="tab" data-tab="move">
                å·²æ¨™è¨˜ç§»å‹• <span class="count-badge" id="tab-move-count">0</span>
            </div>
            <div class="tab" data-tab="skipped">
                å·²æ¨™è¨˜ç•¥é <span class="count-badge" id="tab-skipped-count">0</span>
            </div>
        </div>

        <!-- é‡è¤‡æª”æ¡ˆç¾¤çµ„ç¸½è¦½ -->
        <div class="tab-content active" id="content-groups">
            <h2>é‡è¤‡æª”æ¡ˆç¾¤çµ„ç¸½è¦½ï¼ˆæŒ‰æª”æ¡ˆå¤§å°é™åºæ’åˆ—ï¼‰</h2>
            <div class="file-list" id="list-groups"></div>
        </div>

        <!-- é‡è¤‡æª”æ¡ˆç¾¤çµ„ç¸½è¦½ï¼ˆæŒ‰é‡è¤‡æ¬¡æ•¸æ’åºï¼‰ -->
        <div class="tab-content" id="content-groups-by-count">
            <h2>é‡è¤‡æª”æ¡ˆç¾¤çµ„ç¸½è¦½ï¼ˆæŒ‰é‡è¤‡æ¬¡æ•¸é™åºæ’åˆ—ï¼‰</h2>
            <div class="file-list" id="list-groups-by-count"></div>
        </div>

        <!-- æœªæ¨™è¨˜æª”æ¡ˆ -->
        <div class="tab-content" id="content-unmarked">
            <h2>æœªæ¨™è¨˜æª”æ¡ˆ (MarkType = 0)</h2>
            <div class="file-list" id="list-unmarked"></div>
        </div>

        <!-- å·²æ¨™è¨˜åˆªé™¤ -->
        <div class="tab-content" id="content-deletion">
            <h2>å·²æ¨™è¨˜åˆªé™¤æª”æ¡ˆ (MarkType = 1)</h2>
            <div class="file-list" id="list-deletion"></div>
        </div>

        <!-- å·²æ¨™è¨˜ç§»å‹• -->
        <div class="tab-content" id="content-move">
            <h2>å·²æ¨™è¨˜ç§»å‹•æª”æ¡ˆ (MarkType = 2)</h2>
            <div class="file-list" id="list-move"></div>
        </div>

        <!-- å·²æ¨™è¨˜ç•¥é -->
        <div class="tab-content" id="content-skipped">
            <h2>å·²æ¨™è¨˜ç•¥éæª”æ¡ˆ (MarkType = 3)</h2>
            <div class="file-list" id="list-skipped"></div>
        </div>
    </div>

    <script>
        function formatFileSize(bytes) {
            var sizes = ['B', 'KB', 'MB', 'GB', 'TB'];
            if (bytes === 0) return '0 B';
            var i = parseInt(Math.floor(Math.log(bytes) / Math.log(1024)));
            return (bytes / Math.pow(1024, i)).toFixed(2) + ' ' + sizes[i];
        }

        function switchTab(tabName) {
            // ç§»é™¤æ‰€æœ‰ active é¡åˆ¥
            document.querySelectorAll('.tab').forEach(function(tab) {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-content').forEach(function(content) {
                content.classList.remove('active');
            });

            // æ·»åŠ  active åˆ°é¸ä¸­çš„åˆ†é 
            document.querySelector('.tab[data-tab="' + tabName + '"]').classList.add('active');
            document.getElementById('content-' + tabName).classList.add('active');
        }

        function renderFileItem(file, type) {
            var item = document.createElement('div');
            item.className = 'file-item' + (file.Exists ? '' : ' missing');

            var badges = '';

            // é‡è¤‡æ¬¡æ•¸æ¨™ç±¤ï¼ˆå„ªå…ˆé¡¯ç¤ºï¼‰
            if (file.DuplicateCount && file.DuplicateCount > 1) {
                badges += '<span class="badge" style="background-color: #9f7aea;">ğŸ” é‡è¤‡ ' + file.DuplicateCount + ' æ¬¡</span>';
            }

            badges += file.Exists
                ? '<span class="badge badge-exists">âœ“ å­˜åœ¨</span>'
                : '<span class="badge badge-missing">âœ— éºå¤±</span>';

            if (type === 'deletion' || type === 'move') {
                badges += file.IsProcessed === 1
                    ? '<span class="badge badge-processed">âœ“ å·²è™•ç†</span>'
                    : '<span class="badge badge-pending">â³ å¾…è™•ç†</span>';
            }

            var infoItems = [
                '<span class="file-info-item">ğŸ“¦ å¤§å°ï¼š' + formatFileSize(file.FileSize) + '</span>',
                '<span class="file-info-item">ğŸ“… å»ºç«‹ï¼š' + file.FileCreatedTime + '</span>',
                '<span class="file-info-item">âœï¸ ä¿®æ”¹ï¼š' + file.FileLastModifiedTime + '</span>'
            ];

            if (type === 'deletion' || type === 'move' || type === 'skipped') {
                var timeLabel = type === 'skipped' ? 'ç•¥éæ™‚é–“' : 'æ¨™è¨˜æ™‚é–“';
                var timeValue = type === 'skipped' ? file.SkippedAt : file.MarkedAt;
                if (timeValue) {
                    infoItems.push('<span class="file-info-item">ğŸ•’ ' + timeLabel + 'ï¼š' + timeValue + '</span>');
                }
            }

            if (type === 'deletion' || type === 'move') {
                if (file.ProcessedAt) {
                    infoItems.push('<span class="file-info-item">âœ… è™•ç†æ™‚é–“ï¼š' + file.ProcessedAt + '</span>');
                }
            }

            if (type === 'move' && file.TargetPath) {
                infoItems.push('<span class="file-info-item">ğŸ“‚ ç›®æ¨™ï¼š' + file.TargetPath + '</span>');
            }

            item.innerHTML =
                badges +
                '<div class="file-path">ğŸ“„ ' + file.FilePath + '</div>' +
                '<div class="file-info">' + infoItems.join('') + '</div>' +
                '<div style="font-family: Consolas; font-size: 0.8em; color: #a0aec0; margin-top: 5px;">ğŸ”‘ Hash: ' + file.Hash + '</div>';

            return item;
        }

        function getMarkTypeBadge(markType) {
            var badges = {
                0: '<span class="badge badge-mark-0">æœªæ¨™è¨˜</span>',
                1: '<span class="badge badge-mark-1">å·²æ¨™è¨˜åˆªé™¤</span>',
                2: '<span class="badge badge-mark-2">å·²æ¨™è¨˜ç§»å‹•</span>',
                3: '<span class="badge badge-mark-3">å·²æ¨™è¨˜ç•¥é</span>'
            };
            return badges[markType] || '<span class="badge badge-unmarked">æœªçŸ¥</span>';
        }

        function renderGroupItem(group, index, idPrefix) {
            var item = document.createElement('div');
            item.className = 'file-item';
            item.style.borderLeftColor = group.DuplicateCount > 5 ? '#e53e3e' : '#667eea';

            var duplicateBadge = '<span class="badge" style="background-color: #9f7aea;">ğŸ” é‡è¤‡ ' + group.DuplicateCount + ' æ¬¡</span>';

            var infoItems = [
                '<span class="file-info-item">ğŸ“¦ æ¯å€‹æª”æ¡ˆï¼š' + formatFileSize(group.MaxFileSize) + '</span>',
                '<span class="file-info-item">ğŸ“Š ç¾¤çµ„ç¸½å¤§å°ï¼š' + formatFileSize(group.TotalSize) + '</span>',
                '<span class="file-info-item">ğŸ’¾ å¯ç¯€çœç©ºé–“ï¼š' + formatFileSize(group.TotalSize - group.MaxFileSize) + '</span>'
            ];

            // æª”æ¡ˆåˆ—è¡¨ HTML
            var filesHtml = '';
            if (group.Files && group.Files.length > 0) {
                var uniqueId = idPrefix + '-' + index;
                filesHtml = '<div class="group-files-container">' +
                    '<div class="group-files-toggle" onclick="toggleGroupFiles(\'' + uniqueId + '\')">' +
                    'â–¶ å±•é–‹æª”æ¡ˆåˆ—è¡¨ (' + group.Files.length + ')' +
                    '</div>' +
                    '<div class="group-files-list" id="group-files-' + uniqueId + '">';

                group.Files.forEach(function(file) {
                    var existsBadge = file.Exists
                        ? '<span class="badge badge-exists">âœ“ å­˜åœ¨</span>'
                        : '<span class="badge badge-missing">âœ— éºå¤±</span>';

                    filesHtml += '<div class="group-file-item mark-' + file.MarkType + '">' +
                        getMarkTypeBadge(file.MarkType) + existsBadge +
                        '<div class="file-path" style="margin-top: 5px;">ğŸ“„ ' + file.FilePath + '</div>' +
                        '<div class="file-info">' +
                        '<span class="file-info-item">ğŸ“¦ ' + formatFileSize(file.FileSize) + '</span>' +
                        '<span class="file-info-item">ğŸ“… å»ºç«‹ï¼š' + file.FileCreatedTime + '</span>' +
                        '<span class="file-info-item">âœï¸ ä¿®æ”¹ï¼š' + file.FileLastModifiedTime + '</span>' +
                        '</div>' +
                        '</div>';
                });

                filesHtml += '</div></div>';
            }

            item.innerHTML =
                duplicateBadge +
                '<div class="file-path">ğŸ”‘ Hash: ' + group.Hash + '</div>' +
                '<div class="file-info">' + infoItems.join('') + '</div>' +
                filesHtml;

            return item;
        }

        function toggleGroupFiles(uniqueId) {
            var filesList = document.getElementById('group-files-' + uniqueId);
            var toggle = filesList.previousElementSibling;

            if (filesList.classList.contains('expanded')) {
                filesList.classList.remove('expanded');
                toggle.innerHTML = 'â–¶ å±•é–‹æª”æ¡ˆåˆ—è¡¨ (' + filesList.children.length + ')';
            } else {
                filesList.classList.add('expanded');
                toggle.innerHTML = 'â–¼ æ”¶åˆæª”æ¡ˆåˆ—è¡¨ (' + filesList.children.length + ')';
            }
        }

        function renderGroupList(groups, containerId) {
            var container = document.getElementById(containerId);
            container.innerHTML = '';

            if (groups.length === 0) {
                container.innerHTML = '<div class="empty-state">ç›®å‰æ²’æœ‰é‡è¤‡æª”æ¡ˆç¾¤çµ„</div>';
                return;
            }

            // ä½¿ç”¨ containerId ä½œç‚ºå”¯ä¸€å‰ç¶´ï¼Œé¿å… ID è¡çª
            var idPrefix = containerId.replace('list-', '');
            groups.forEach(function(group, index) {
                container.appendChild(renderGroupItem(group, index, idPrefix));
            });
        }

        function renderFileList(files, containerId, type) {
            var container = document.getElementById(containerId);
            container.innerHTML = '';

            if (files.length === 0) {
                container.innerHTML = '<div class="empty-state">ç›®å‰æ²’æœ‰æª”æ¡ˆ</div>';
                return;
            }

            files.forEach(function(file) {
                container.appendChild(renderFileItem(file, type));
            });
        }

        function renderReport(reportData) {
            // æ¸²æŸ“æ‘˜è¦
            document.getElementById('generated-time').textContent = reportData.GeneratedAt;
            document.getElementById('total-files').textContent = reportData.Summary.TotalFiles;

            document.getElementById('duplicate-groups-count').textContent = reportData.Summary.TotalDuplicateGroups;
            document.getElementById('duplicate-groups-size').textContent = formatFileSize(reportData.Summary.TotalDuplicateGroupsSize);
            document.getElementById('max-duplicate-count').textContent = reportData.Summary.MaxDuplicateCount;

            document.getElementById('unmarked-count').textContent = reportData.Summary.UnmarkedCount;
            document.getElementById('unmarked-size').textContent = formatFileSize(reportData.Summary.UnmarkedSize);

            document.getElementById('deletion-count').textContent = reportData.Summary.MarkedForDeletionCount;
            document.getElementById('deletion-size').textContent = formatFileSize(reportData.Summary.MarkedForDeletionSize);

            document.getElementById('move-count').textContent = reportData.Summary.MarkedForMoveCount;
            document.getElementById('move-size').textContent = formatFileSize(reportData.Summary.MarkedForMoveSize);

            document.getElementById('skipped-count').textContent = reportData.Summary.SkippedCount;
            document.getElementById('skipped-size').textContent = formatFileSize(reportData.Summary.SkippedSize);

            // æ›´æ–°åˆ†é æ¨™ç±¤è¨ˆæ•¸
            document.getElementById('tab-groups-count').textContent = reportData.Summary.TotalDuplicateGroups;
            document.getElementById('tab-groups-by-count-count').textContent = reportData.Summary.TotalDuplicateGroups;
            document.getElementById('tab-unmarked-count').textContent = reportData.Summary.UnmarkedCount;
            document.getElementById('tab-deletion-count').textContent = reportData.Summary.MarkedForDeletionCount;
            document.getElementById('tab-move-count').textContent = reportData.Summary.MarkedForMoveCount;
            document.getElementById('tab-skipped-count').textContent = reportData.Summary.SkippedCount;

            // æ¸²æŸ“æª”æ¡ˆåˆ—è¡¨
            renderGroupList(reportData.DuplicateGroups, 'list-groups');
            renderGroupList(reportData.DuplicateGroupsByCount, 'list-groups-by-count');
            renderFileList(reportData.UnmarkedFiles, 'list-unmarked', 'unmarked');
            renderFileList(reportData.MarkedForDeletion, 'list-deletion', 'deletion');
            renderFileList(reportData.MarkedForMove, 'list-move', 'move');
            renderFileList(reportData.SkippedFiles, 'list-skipped', 'skipped');
        }

        // åˆ†é åˆ‡æ›äº‹ä»¶
        document.querySelectorAll('.tab').forEach(function(tab) {
            tab.addEventListener('click', function() {
                switchTab(this.dataset.tab);
            });
        });

        // è¼‰å…¥å ±è¡¨
        window.addEventListener('DOMContentLoaded', function() {
            var reportData = JSON.parse(document.getElementById('reportData').textContent);
            renderReport(reportData);
        });
    </script>
</body>
</html>
