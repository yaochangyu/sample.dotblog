# Program.cs é‡æ§‹è¨ˆç•«

ç¶“éåˆ†æï¼Œæˆ‘ç™¼ç¾ä»¥ä¸‹é‡è¤‡çš„ç¨‹å¼ç¢¼æ¨¡å¼ï¼Œä»¥ä¸‹æ˜¯æ¶ˆé™¤é‡è¤‡çš„é‡æ§‹è¨ˆç•«:

## ğŸ” é‡è¤‡æ¨¡å¼è­˜åˆ¥

### 1. é è¦½åŠŸèƒ½é‡è¤‡ (å‡ºç¾ 3 æ¬¡)
- `ViewMarkedForDeletionFiles()` ç¬¬ 997-1040 è¡Œ
- `ViewSkippedFiles()` ç¬¬ 814-874 è¡Œ
- `InteractiveDeleteDuplicates()` ç¬¬ 358-393 è¡Œ

é€™ä¸‰è™•éƒ½æœ‰é¡ä¼¼çš„é è¦½é‚è¼¯ï¼Œè™•ç† `p` æŒ‡ä»¤ä¸¦è§£æç·¨è™Ÿã€‚

### 2. å ±è¡¨ç”Ÿæˆé‡è¤‡ (å‡ºç¾ 2 æ¬¡)
- `GenerateJsonReport()` ç¬¬ 1420-1461 è¡Œ
- `GenerateMarkedForDeletionJsonReport()` ç¬¬ 1463-1504 è¡Œ
- `GenerateHtmlReport()` ç¬¬ 1506-1559 è¡Œ
- `GenerateMarkedForDeletionHtmlReport()` ç¬¬ 1561-1614 è¡Œ

é€™äº›æ–¹æ³•çµæ§‹å¹¾ä¹ç›¸åŒï¼Œåªæ˜¯è³‡æ–™ä¾†æºä¸åŒã€‚

### 3. ç¢ºèªå°è©±æ¡†é‡è¤‡ (å‡ºç¾å¤šæ¬¡)
- ç¬¬ 426-430 è¡Œã€501-504 è¡Œã€663-666 è¡Œã€878-881 è¡Œã€1044-1047 è¡Œã€1091-1094 è¡Œ

å¤šè™•ä½¿ç”¨ç›¸åŒçš„ `(Y/n)` ç¢ºèªé‚è¼¯ã€‚

### 4. è³‡æ–™åº«æ“ä½œé‡è¤‡
- `LoadMarkedForDeletionFilesWithDetails()` å’Œ `LoadMarkedForDeletionFilesGroupedByHash()`
- `GenerateJsonReport()` å’Œ `GenerateMarkedForDeletionJsonReport()`

## ğŸ“‹ é‡æ§‹è¨ˆç•«

### éšæ®µ 1: æå–å…±ç”¨æ–¹æ³• âœ…

- [x] 1.1 æå–é è¦½åŠŸèƒ½
  ```csharp
  static List<int> ParsePreviewIndices(string previewPart, int maxCount)
  static bool HandlePreviewCommand(string? choice, List<string> files)
  ```

- [x] 1.2 æå–ç¢ºèªå°è©±æ¡†
  ```csharp
  static bool ConfirmAction(string message)
  ```

- [x] 1.3 çµ±ä¸€å ±è¡¨ç”Ÿæˆ
  ```csharp
  static void GenerateReport(
      Dictionary<string, List<(string path, string timestamp)>> groups,
      string reportPrefix,
      string templateFileName,
      string timestampLabel)
  ```

- [x] 1.4 æå– JSON åºåˆ—åŒ–é‚è¼¯
  ```csharp
  static string SerializeReportData(object reportData, bool indent = true)
  static object CreateReportData(
      Dictionary<string, List<(string path, string timestamp)>> groups,
      string timestampLabel)
  ```

### éšæ®µ 2: é‡æ§‹è³‡æ–™çµæ§‹ âœ…

- [x] 2.1 å»ºç«‹å…±ç”¨è³‡æ–™æ¨¡å‹
  ```csharp
  record FileRecord(string Path, string Timestamp, bool Exists, long Size, DateTime? CreatedTime, DateTime? ModifiedTime)
  record FileGroup(string Hash, List<FileRecord> Files)
  ```

- [x] 2.2 çµ±ä¸€è³‡æ–™è¼‰å…¥æ–¹æ³•
  ```csharp
  static Dictionary<string, List<(string path, string timestamp)>> LoadFilesGroupedByHash(
      string tableName,
      string timestampColumn)
  ```

### éšæ®µ 3: ç°¡åŒ–æ“ä½œé¸å–® âœ…

- [x] 3.1 æå–é¡¯ç¤ºè™•ç†é‚è¼¯
  ```csharp
  static void DisplayMenu(params string[] options)
  static void DisplayFileInfo(string path, bool showDetails = true)
  static void DisplayFileGroup(List<(string path, string timestamp)> files, string timestampLabel)
  ```

- [x] 3.2 çµ±ä¸€ç·¨è™Ÿè§£æï¼ˆå·²åœ¨éšæ®µ1å®Œæˆï¼‰
  ```csharp
  static List<int> ParseIndices(string? input, int maxCount)
  // å·²åœ¨ ViewSkippedFilesã€ViewMarkedForDeletionFilesã€InteractiveDeleteDuplicates ä¸­ä½¿ç”¨
  ```

### éšæ®µ 4: æ”¹å–„æ¶æ§‹ âœ… (éƒ¨åˆ†å®Œæˆ)

- [x] 4.1 å»ºç«‹è³‡æ–™åº«è¼”åŠ©é¡åˆ¥ï¼ˆè¼•é‡ç´šï¼‰
  ```csharp
  static class DatabaseHelper
  {
      static SqliteConnection CreateConnection()
      static int ExecuteNonQuery(string commandText, Action<SqliteCommand>? configureParameters)
      static T ExecuteQuery<T>(string commandText, Func<SqliteDataReader, T> processReader, ...)
      static void ExecuteTransaction(Action<SqliteConnection, SqliteTransaction> action)
  }
  // å·²æ‡‰ç”¨æ–¼: LoadFilesGroupedByHash, ClearAllMarks, ClearAllSkippedMarks
  ```

- [x] 4.2 å ±è¡¨æœå‹™ï¼ˆå·²åœ¨éšæ®µ1å®Œæˆï¼‰
  ```csharp
  // GenerateReport, CreateReportData, SerializeReportData å·²åœ¨éšæ®µ1å»ºç«‹
  ```

- [x] 4.3 æª”æ¡ˆé è¦½æœå‹™ï¼ˆå·²åœ¨éšæ®µ1å®Œæˆï¼‰
  ```csharp
  // PreviewFiles, HandlePreviewCommand å·²åœ¨éšæ®µ1å»ºç«‹
  ```

- [x] 4.4 UI é‚è¼¯åˆ†é›¢ï¼ˆå·²åœ¨éšæ®µ3å®Œæˆï¼‰
  ```csharp
  // DisplayMenu, DisplayFileInfo, DisplayFileGroup, ConfirmAction å·²åœ¨éšæ®µ1&3å»ºç«‹
  ```

## ğŸ“Š å¯¦éš›æˆæœ vs é æœŸæ•ˆæœ

### é æœŸæ•ˆæœ
- **ç¨‹å¼ç¢¼è¡Œæ•¸**: å¾ 1990 è¡Œæ¸›å°‘åˆ°ç´„ 1400-1500 è¡Œ (æ¸›å°‘ 25-30%)
- **æ–¹æ³•æ•¸é‡**: å¾ 40+ å€‹æ–¹æ³•æ•´åˆåˆ°ç´„ 30 å€‹
- **å¯ç¶­è­·æ€§**: ä¿®æ”¹å ±è¡¨æ ¼å¼æˆ–é è¦½é‚è¼¯åªéœ€æ”¹ä¸€è™•
- **å¯æ¸¬è©¦æ€§**: æå–çš„å°æ–¹æ³•æ›´å®¹æ˜“é€²è¡Œå–®å…ƒæ¸¬è©¦

### å¯¦éš›æˆæœ
- **ç¨‹å¼ç¢¼è¡Œæ•¸**: å¾ 1990 è¡Œåˆ° 1977 è¡Œï¼ˆæ·¨æ¸›å°‘ 13 è¡Œï¼Œç´„ 0.7%ï¼‰
  - éšæ®µ 1: -146 è¡Œï¼ˆæ¶ˆé™¤é‡è¤‡ï¼‰
  - éšæ®µ 2: +44 è¡Œï¼ˆæ–°å¢è³‡æ–™æ¨¡å‹ï¼‰
  - éšæ®µ 3: +33 è¡Œï¼ˆæ–°å¢é¡¯ç¤ºæ–¹æ³•ï¼‰
  - éšæ®µ 4: +56 è¡Œï¼ˆæ–°å¢ DatabaseHelperï¼‰
- **æ–°å¢å…±ç”¨æ–¹æ³•**: 14 å€‹
  - éšæ®µ 1: 7 å€‹ï¼ˆå·¥å…·æ–¹æ³•ï¼‰
  - éšæ®µ 2: 1 å€‹ï¼ˆè³‡æ–™è¼‰å…¥ï¼‰
  - éšæ®µ 3: 3 å€‹ï¼ˆUI é¡¯ç¤ºï¼‰
  - éšæ®µ 4: 3 å€‹ï¼ˆDatabaseHelper æ–¹æ³•ï¼Œå¯¦éš›ç‚ºéœæ…‹é¡åˆ¥çš„ 4 å€‹æ–¹æ³•ï¼‰
- **åˆªé™¤é‡è¤‡æ–¹æ³•**: 6 å€‹ï¼ˆ4 å€‹å ±è¡¨ + 2 å€‹è¼‰å…¥ï¼‰
- **æ–°å¢è³‡æ–™æ¨¡å‹**: 2 å€‹ï¼ˆFileRecord + FileGroupï¼‰
- **æ–°å¢è¼”åŠ©é¡åˆ¥**: 1 å€‹ï¼ˆDatabaseHelperï¼‰
- **å¯ç¶­è­·æ€§**: âœ… é”æˆ - å ±è¡¨ã€é è¦½ã€ç¢ºèªå°è©±æ¡†ã€é¸å–®é¡¯ç¤ºéƒ½å·²çµ±ä¸€
- **å¯æ¸¬è©¦æ€§**: âœ… é”æˆ - æ–¹æ³•æ›´å°ã€è·è²¬æ›´å–®ä¸€

## ğŸ¯ å„ªå…ˆé †åºå»ºè­°

1. **é«˜å„ªå…ˆ**: éšæ®µ 1 (æå–å…±ç”¨æ–¹æ³•) - ç«‹å³è¦‹æ•ˆ
2. **ä¸­å„ªå…ˆ**: éšæ®µ 2 (é‡æ§‹è³‡æ–™çµæ§‹) - é•·æœŸç¶­è­·
3. **ä½å„ªå…ˆ**: éšæ®µ 3-4 (æ¶æ§‹æ”¹å–„) - å¯é¸æ“‡æ€§åŸ·è¡Œ

## ğŸ“ åŸ·è¡Œè¨˜éŒ„

- [x] éšæ®µ 1 å®Œæˆ (2025-10-06)
  - ç¨‹å¼ç¢¼è¡Œæ•¸ï¼šå¾ 1990 è¡Œæ¸›å°‘åˆ° 1844 è¡Œï¼ˆæ¸›å°‘ 146 è¡Œï¼Œç´„ 7.3%ï¼‰
  - ç·¨è­¯çµæœï¼šæˆåŠŸï¼Œ0 è­¦å‘Š 0 éŒ¯èª¤
  - ä¸»è¦æ”¹å–„ï¼š
    - æå–äº† 4 å€‹å…±ç”¨æ–¹æ³•ï¼ˆHandlePreviewCommandã€ConfirmActionã€ParseIndicesã€ParsePreviewIndicesï¼‰
    - çµ±ä¸€äº†å ±è¡¨ç”Ÿæˆé‚è¼¯ï¼ˆCreateReportDataã€SerializeReportDataã€GenerateReportï¼‰
    - åˆªé™¤äº† 4 å€‹é‡è¤‡çš„å ±è¡¨ç”Ÿæˆæ–¹æ³•
    - æ‰€æœ‰é è¦½åŠŸèƒ½å’Œç¢ºèªå°è©±æ¡†éƒ½å·²é‡æ§‹ä½¿ç”¨å…±ç”¨æ–¹æ³•
- [x] éšæ®µ 2 å®Œæˆ (2025-10-06)
  - ç¨‹å¼ç¢¼è¡Œæ•¸ï¼šå¾ 1844 è¡Œå¢åŠ åˆ° 1888 è¡Œï¼ˆå¢åŠ  44 è¡Œï¼Œä¸»è¦æ˜¯æ–°å¢è³‡æ–™æ¨¡å‹å®šç¾©ï¼‰
  - ç·¨è­¯çµæœï¼šæˆåŠŸï¼Œ0 è­¦å‘Š 0 éŒ¯èª¤
  - ä¸»è¦æ”¹å–„ï¼š
    - æ–°å¢ FileRecord å’Œ FileGroup è³‡æ–™æ¨¡å‹ï¼Œæä¾›å¼·å‹åˆ¥æ”¯æ´
    - çµ±ä¸€è³‡æ–™è¼‰å…¥æ–¹æ³• LoadFilesGroupedByHashï¼Œæ¶ˆé™¤é‡è¤‡çš„è³‡æ–™åº«æŸ¥è©¢é‚è¼¯
    - LoadMarkedForDeletionFilesGroupedByHash å’Œ LoadSkippedFilesGroupedByHash ç°¡åŒ–ç‚ºä¸€è¡Œå‘¼å«
    - ç‚ºæœªä¾†æ“´å……å¥ å®šè‰¯å¥½çš„è³‡æ–™çµæ§‹åŸºç¤
- [x] éšæ®µ 3 å®Œæˆ (2025-10-06)
  - ç¨‹å¼ç¢¼è¡Œæ•¸ï¼šå¾ 1888 è¡Œå¢åŠ åˆ° 1921 è¡Œï¼ˆå¢åŠ  33 è¡Œï¼Œä¸»è¦æ˜¯æ–°å¢é¡¯ç¤ºè¼”åŠ©æ–¹æ³•ï¼‰
  - ç·¨è­¯çµæœï¼šæˆåŠŸï¼Œ0 è­¦å‘Š 0 éŒ¯èª¤
  - ä¸»è¦æ”¹å–„ï¼š
    - æ–°å¢ DisplayMenu çµ±ä¸€é¸å–®é¡¯ç¤ºé‚è¼¯ï¼ˆ3 è™•ä½¿ç”¨ï¼‰
    - æ–°å¢ DisplayFileInfo çµ±ä¸€æª”æ¡ˆè³‡è¨Šé¡¯ç¤º
    - æ–°å¢ DisplayFileGroup çµ±ä¸€æª”æ¡ˆç¾¤çµ„é¡¯ç¤ºï¼ˆç°¡åŒ– ViewSkippedFiles çš„é¡¯ç¤ºé‚è¼¯ï¼‰
    - é©—è­‰ ParseIndices åœ¨éšæ®µ 1 å·²å®Œæ•´æ‡‰ç”¨æ–¼æ‰€æœ‰éœ€è¦çš„åœ°æ–¹
    - æ”¹å–„ç¨‹å¼ç¢¼å¯è®€æ€§å’Œä¸€è‡´æ€§
- [x] éšæ®µ 4 å®Œæˆ (2025-10-06) - éƒ¨åˆ†å®Œæˆ
  - ç¨‹å¼ç¢¼è¡Œæ•¸ï¼šå¾ 1921 è¡Œå¢åŠ åˆ° 1977 è¡Œï¼ˆå¢åŠ  56 è¡Œï¼Œä¸»è¦æ˜¯æ–°å¢ DatabaseHelper é¡åˆ¥ï¼‰
  - ç·¨è­¯çµæœï¼šæˆåŠŸï¼ˆDLL ç·¨è­¯æˆåŠŸï¼ŒEXE è¢«ç¨‹å¼é–å®šï¼‰
  - ä¸»è¦æ”¹å–„ï¼š
    - æ–°å¢ DatabaseHelper è¼•é‡ç´šè³‡æ–™åº«è¼”åŠ©é¡åˆ¥ï¼Œæä¾› 4 å€‹æ ¸å¿ƒæ–¹æ³•
    - ç¤ºç¯„æ€§åœ°æ”¹å¯« 3 å€‹æ–¹æ³•ä½¿ç”¨ DatabaseHelperï¼ˆLoadFilesGroupedByHash, ClearAllMarks, ClearAllSkippedMarksï¼‰
    - å…¶ä»–æœå‹™å±¤åŠŸèƒ½å·²åœ¨éšæ®µ 1-3 å®Œæˆï¼ˆå ±è¡¨ã€é è¦½ã€UIï¼‰
    - ç‚ºæœªä¾†é€²ä¸€æ­¥æ¶æ§‹æ”¹å–„å¥ å®šåŸºç¤
  - è¨»è¨˜ï¼šéšæ®µ 4 æ¡å–è¼•é‡ç´šå¯¦ä½œæ–¹å¼ï¼Œé¿å…éåº¦è¨­è¨ˆï¼Œä¿æŒç¨‹å¼ç¢¼ç°¡æ½”
